from google.cloud import bigquery
from pathlib import Path
import pydata_google_auth


SCOPES = [
    'https://www.googleapis.com/auth/cloud-platform',
    'https://www.googleapis.com/auth/drive',
]

credentials = pydata_google_auth.get_user_credentials(
    SCOPES,
    # Set auth_local_webserver to True to have a slightly more convienient
    # authorization flow. Note, this doesn't work if you're running from a
    # notebook on a remote sever, such as over SSH or with Google Colab.
    auth_local_webserver=True,
)

sql_iii = Path('mimic-iii.sql').read_text()
sql_iv = Path('mimic-iv.sql').read_text()

# Construct a BigQuery client object.
project_id = 'auspicious-silo-247823'
client = bigquery.Client(project=project_id, credentials=credentials)

job_config = bigquery.job.QueryJobConfig()
job_config.destination_format = bigquery.DestinationFormat.NEWLINE_DELIMITED_JSON

query_job = client.query(sql_iii, job_config=job_config)  # Make an API request.

for row in query_job:
    print(row)
